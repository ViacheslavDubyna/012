# Типові помилки та їх вирішення

Цей документ містить опис типових помилок, які можуть виникати при запуску інформаційно-аналітичної системи Національної гвардії України, та способи їх вирішення.

## Зміст

1. [Помилки при запуску PostgreSQL](#помилки-при-запуску-postgresql)
2. [Помилки при підключенні до бази даних](#помилки-при-підключенні-до-бази-даних)
3. [Помилки при встановленні залежностей](#помилки-при-встановленні-залежностей)
4. [Помилки при інтеграції Dash з Flask](#помилки-при-інтеграції-dash-з-flask)
5. [Помилки при завантаженні GeoJSON](#помилки-при-завантаженні-geojson)

## Помилки при запуску PostgreSQL

### Помилка: "PostgreSQL не запущено"

**Причина**: Служба PostgreSQL не запущена або не встановлена.

**Вирішення**:

1. Перевірте, чи встановлено PostgreSQL:
   - Windows: Перевірте наявність служби PostgreSQL у списку служб (services.msc)
   - Linux: `sudo systemctl status postgresql`
   - macOS: `brew services list | grep postgresql`

2. Запустіть службу PostgreSQL:
   - Windows: Відкрийте "Служби" (Services) через Панель керування, знайдіть службу PostgreSQL і запустіть її
   - Linux: `sudo systemctl start postgresql`
   - macOS: `brew services start postgresql`

3. Якщо PostgreSQL не встановлено, встановіть його:
   - Windows: Завантажте інсталятор з офіційного сайту: https://www.postgresql.org/download/windows/
   - Linux: `sudo apt install postgresql postgresql-contrib`
   - macOS: `brew install postgresql`

## Помилки при підключенні до бази даних

### Помилка: "password authentication failed for user postgres"

**Причина**: Неправильний пароль для користувача postgres.

**Вирішення**:

1. Перевірте налаштування у файлі `config/config.py`:
   ```python
   DB_CONFIG = {
       'user': 'postgres',
       'password': 'postgres',  # Змініть на правильний пароль
       'host': 'localhost',
       'port': '5432',
       'database': 'ngu_ias'
   }
   ```

2. Змініть пароль користувача postgres:
   - Windows: Відкрийте pgAdmin, підключіться до сервера, змініть пароль користувача postgres
   - Linux/macOS: `sudo -u postgres psql -c "ALTER USER postgres WITH PASSWORD 'postgres';"`

### Помилка: "database ngu_ias does not exist"

**Причина**: База даних не створена.

**Вирішення**:

1. Створіть базу даних вручну:
   - Підключіться до PostgreSQL: `psql -U postgres`
   - Створіть базу даних: `CREATE DATABASE ngu_ias;`

2. Або запустіть скрипт налаштування бази даних:
   ```bash
   python setup_postgres.py
   ```

## Помилки при встановленні залежностей

### Помилка: "ModuleNotFoundError: No module named 'dash'"

**Причина**: Пакет dash не встановлено.

**Вирішення**:

1. Встановіть пакет dash:
   ```bash
   pip install dash==2.14.0
   ```

2. Встановіть всі необхідні залежності з файлу requirements.txt:
   ```bash
   pip install -r requirements.txt
   ```

### Помилка: "Microsoft Visual C++ 14.0 or greater is required"

**Причина**: Відсутній компілятор C++ для встановлення деяких пакетів.

**Вирішення**:

1. Завантажте та встановіть Microsoft C++ Build Tools: https://visualstudio.microsoft.com/visual-cpp-build-tools/

2. Або встановіть попередньо скомпільовані бінарні пакети:
   ```bash
   pip install psycopg2-binary
   ```

## Помилки при інтеграції Dash з Flask

### Помилка: "ImportError: cannot import name 'register_dashapp' from 'dashboard'"

**Причина**: Проблема з імпортом функції для інтеграції Dash з Flask.

**Вирішення**:

1. Перевірте, чи правильно імпортується функція register_dashapp:
   ```python
   from dashboard.improved_dashboard_routes import register_dashapp
   ```

2. Перевірте наявність файлу improved_dashboard_routes.py у директорії dashboard.

### Помилка: "TypeError: 'Flask' object is not callable"

**Причина**: Неправильна інтеграція Dash з Flask.

**Вирішення**:

1. Перевірте код інтеграції Dash з Flask у файлі run.py.

2. Використовуйте правильний спосіб інтеграції:
   ```python
   from werkzeug.middleware.dispatcher import DispatcherMiddleware
   from werkzeug.serving import run_simple
   
   dispatcher = DispatcherMiddleware(flask_app, {
       '/dashboard/improved': dash_app.server
   })
   
   run_simple('0.0.0.0', 5000, dispatcher, use_reloader=True)
   ```

## Помилки при завантаженні GeoJSON

### Помилка: "JSONDecodeError: Expecting value: line 1 column 1"

**Причина**: Неправильний формат даних при завантаженні GeoJSON.

**Вирішення**:

1. Використовуйте надійне джерело GeoJSON даних України:
   ```python
   response = requests.get('https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/ukraine.geojson')
   ukraine_geojson = response.json()
   ```

2. Додайте обробку помилок при завантаженні GeoJSON:
   ```python
   try:
       response = requests.get('URL_TO_GEOJSON')
       geojson_data = response.json()
   except Exception as e:
       print(f"Помилка при завантаженні GeoJSON: {e}")
       # Використовуйте запасний варіант
   ```

### Помилка: "No such file or directory"

**Причина**: Файл GeoJSON не знайдено за вказаним шляхом.

**Вирішення**:

1. Використовуйте онлайн-джерело GeoJSON замість локального файлу.

2. Перевірте шлях до файлу та використовуйте абсолютні шляхи замість відносних.

3. Додайте перевірку наявності файлу перед його використанням:
   ```python
   import os
   
   file_path = 'path/to/geojson/file.geojson'
   if os.path.exists(file_path):
       # Використовуйте файл
   else:
       # Використовуйте альтернативне джерело
   ```