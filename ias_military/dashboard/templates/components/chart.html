{% macro render_chart(chart_id, chart_type, chart_data, chart_options={}) %}
{% if not chart_id %}
  {{ throw('Параметр chart_id обов'язковий для макросу render_chart') }}
{% endif %}
{% if not chart_type %}
  {{ throw('Параметр chart_type обов'язковий для макросу render_chart') }}
{% endif %}
<div class="chart-container">
  <canvas id="{{ chart_id }}"></canvas>
</div>

<script>
  function initChart() {
    if (!document.getElementById('{{ chart_id }}')) return;
    const ctx = document.getElementById('{{ chart_id }}');
    
    const options = Object.assign({
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'bottom' },
        tooltip: { enabled: true }
      }
    }, {{ chart_options|default({})|tojson|safe }});

    new Chart(ctx, {
      type: '{{ chart_type }}',
      data: {{ chart_data|tojson|safe }},
      options: options
    });
  }
  
  if (document.readyState === 'complete') {
    initChart();
  } else {
    document.addEventListener('DOMContentLoaded', initChart);
    window.chartInitializers = window.chartInitializers || [];
    window.chartInitializers.push(initChart);
  }
</script>
{% endmacro %}